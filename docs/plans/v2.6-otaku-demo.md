# v2.6: Otaku — The Autonomous Wallet Demo

**Theme**: OpenClaw + ERC-8004 + x402 = The New Meta

## Vision

Otaku becomes THE demo for what autonomous agents with wallets can do:

- **x402 payments** — Agent pays for API services autonomously
- **ERC-8004 identity** — On-chain agent registration, reputation, trust
- **CDP + BANKR** — Full DeFi execution (swaps, limits, DCA, yield)
- **Cross-chain** — MEE gasless operations across 6+ chains

---

## Current State (v2.5)

### Otaku Agent

| Component     | Status | Notes                               |
| ------------- | ------ | ----------------------------------- |
| CDP Plugin    | ✅     | Wallet info, transfers, swaps, NFTs |
| BANKR Plugin  | ✅     | Agent prompt, orders, portfolio     |
| plugin-otaku  | ✅     | OTAKU_SWAP, LIMIT, DCA, POSITIONS   |
| Morpho Plugin | ✅     | DeFi lending (supply/withdraw)      |
| Relay Plugin  | ✅     | Cross-chain bridging                |
| MEE Plugin    | ✅     | Gasless swaps, rebalancing          |
| x402 Action   | ❌     | **Commented out** in plugin-cdp     |
| ERC-8004      | ❌     | Not implemented                     |
| Nansen MCP    | ✅     | Smart money tracking                |

### What Works

- Token swaps, transfers, bridges
- Limit orders, DCA via BANKR
- Portfolio viewing
- Morpho lending
- Gasless MEE swaps

### What's Missing

1. **x402 FETCH_WITH_PAYMENT** — exists but commented out
2. **ERC-8004 Agent Identity** — not implemented
3. **Reputation tracking** — no feedback loop
4. **Real-time alerts** — no position monitoring
5. **Advanced orders** — no stop-loss, trailing stops
6. **Gas optimization** — no timing / batching
7. **Portfolio analytics** — no performance tracking
8. **Risk management** — no exposure limits

---

## Proposed Improvements

### 1. Enable x402 Payment Protocol (P0)

**Goal**: Otaku can pay for API services autonomously

**Files**:

- `src/plugins/plugin-cdp/index.ts` — uncomment `cdpWalletFetchWithPayment`
- `src/plugins/plugin-cdp/actions/cdp-wallet-fetch-with-payment.ts` — review + test

**Usage**:

```
User: "fetch https://api.example.com/paid-data"
Otaku: Detects 402, pays USDC, returns data + receipt
```

**Config**:

```env
X402_RECEIVING_WALLET=0x...
X402_PUBLIC_URL=https://...
X402_FACILITATOR_URL=https://facilitator.payai.network
```

---

### 2. ERC-8004 Agent Identity (P1)

**Goal**: Register Otaku on-chain as a trustless agent

**New plugin**: `plugin-erc8004`

**Actions**:

- `AGENT_REGISTER` — Mint agent NFT on Identity Registry
- `AGENT_UPDATE` — Update agent metadata (skills, capabilities)
- `AGENT_LOOKUP` — Find agents by capability
- `REPUTATION_SUBMIT` — Submit feedback for another agent
- `REPUTATION_QUERY` — Check agent reputation score
- `VALIDATION_REQUEST` — Request task validation

**On-chain components**:

- Identity Registry (ERC-721) — Agent NFT
- Reputation Registry — Feedback signals
- Validation Registry — Validator hooks

**Agent metadata** (off-chain, URI-linked):

```json
{
  "name": "Otaku",
  "role": "COO",
  "capabilities": ["swap", "bridge", "limit-order", "dca", "yield"],
  "chains": ["base", "ethereum", "arbitrum", "polygon"],
  "paymentAddress": "0x...",
  "openClawVersion": "2.6.0"
}
```

---

### 3. Advanced Order Types (P1)

**New actions in plugin-otaku**:

| Action                | Description                            |
| --------------------- | -------------------------------------- |
| `OTAKU_STOP_LOSS`     | Sell if price drops below threshold    |
| `OTAKU_TAKE_PROFIT`   | Sell if price rises above threshold    |
| `OTAKU_TRAILING_STOP` | Dynamic stop that follows price up     |
| `OTAKU_OCO`           | One-cancels-other (stop + take profit) |
| `OTAKU_TWAP`          | Time-weighted average price execution  |

**Implementation**: Route through BANKR_AGENT_PROMPT with structured prompts

---

### 4. Real-Time Position Monitoring (P1)

**New service**: `OtakuMonitorService`

**Features**:

- Poll positions every N minutes
- Alert on significant changes (>5% move, liquidation risk)
- Track P&L in real-time
- Push to Discord when thresholds hit

**Actions**:

- `OTAKU_SET_ALERT` — "alert me if ETH drops below $3000"
- `OTAKU_ALERTS` — List active alerts
- `OTAKU_CANCEL_ALERT` — Remove alert

---

### 5. Portfolio Analytics (P2)

**New actions**:

- `OTAKU_PERFORMANCE` — P&L, win rate, best/worst trades
- `OTAKU_EXPOSURE` — Asset allocation, chain distribution
- `OTAKU_HISTORY` — Trade history with timestamps
- `OTAKU_GAS_SPENT` — Total gas costs tracked

**Data storage**: Local JSON or Supabase for persistence

---

### 6. Risk Management (P2)

**New provider**: `OtakuRiskProvider`

**Checks before execution**:

- Max position size per trade
- Max total exposure
- Slippage tolerance
- Gas price limits
- Cooldown between large trades

**Config**:

```env
OTAKU_MAX_TRADE_USD=1000
OTAKU_MAX_EXPOSURE_USD=10000
OTAKU_MAX_SLIPPAGE_BPS=100
OTAKU_TRADE_COOLDOWN_MS=60000
```

---

### 7. Gas Optimization (P2)

**Smart execution**:

- Queue non-urgent trades for low gas windows
- Batch multiple small swaps
- Prefer gasless MEE when available
- Track historical gas patterns

---

### 8. Demo Mode (P0)

**Purpose**: Showcase capabilities without real funds

**New config**:

```env
OTAKU_DEMO_MODE=true
OTAKU_DEMO_STARTING_BALANCE=10000  # Simulated USD
```

**Behavior**:

- All trades simulated (no real execution)
- Track "paper" portfolio
- Show what would have happened
- Perfect for demos and testing

---

## Implementation Priority

### Sprint 1 (P0 - This Week)

1. [ ] Enable x402 FETCH_WITH_PAYMENT action
2. [ ] Add demo mode for showcasing
3. [ ] Test existing actions end-to-end

### Sprint 2 (P1 - Next Week)

4. [ ] plugin-erc8004 scaffold
5. [ ] AGENT_REGISTER + AGENT_LOOKUP
6. [ ] Advanced orders (stop-loss, take-profit)
7. [ ] Real-time alerts service

### Sprint 3 (P2 - Following)

8. [ ] Portfolio analytics
9. [ ] Risk management provider
10. [ ] Gas optimization
11. [ ] Full ERC-8004 reputation flow

---

## Files to Create/Modify

### New Files

```
src/plugins/plugin-erc8004/
├── src/
│   ├── index.ts
│   ├── actions/
│   │   ├── agentRegister.action.ts
│   │   ├── agentLookup.action.ts
│   │   ├── reputationSubmit.action.ts
│   │   └── reputationQuery.action.ts
│   ├── services/
│   │   └── erc8004.service.ts
│   └── types.ts
├── package.json
└── tsconfig.json

src/plugins/plugin-otaku/src/
├── actions/
│   ├── otakuStopLoss.action.ts
│   ├── otakuTakeProfit.action.ts
│   ├── otakuTrailingStop.action.ts
│   └── otakuAlerts.action.ts
├── services/
│   └── otakuMonitor.service.ts
└── providers/
    └── otakuRisk.provider.ts
```

### Modified Files

```
src/plugins/plugin-cdp/index.ts           # Uncomment x402 action
src/plugins/plugin-otaku/src/index.ts     # Add new actions
src/agents/otaku.ts                       # Add new plugins
.env.example                              # Add new config
```

---

## Success Metrics

1. **Demo-ready**: Can showcase full flow in 5 minutes
2. **x402 working**: Agent pays for API, gets data
3. **ERC-8004 identity**: Otaku registered on Base
4. **Order types**: Stop-loss executes correctly
5. **Alerts**: Discord notification when price hits target

---

## The Demo Script

1. "Show my portfolio" → Otaku shows holdings across chains
2. "Swap $50 USDC to ETH on Base" → Confirms, executes, shows tx
3. "Set stop-loss at $2800 for my ETH" → Creates order
4. "Fetch market data from [x402 API]" → Pays, returns data
5. "What's my agent identity?" → Shows ERC-8004 NFT
6. "Check my reputation" → Shows feedback from other agents

**North star**: Autonomous agent economy demo in under 10 minutes.
