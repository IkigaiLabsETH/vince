# v2.4 Plan â€” Multi-Agent Deep Dive

**Status:** Planning
**Created:** 2026-02-12
**Branch:** `feature/v2.4-multiagent`

---

## Context

The dream team is complete (8 agents). BANKR integration is done. Now we need to make them **work together** like a real team.

**North Star (from MULTI_AGENT.md):**
> A Discord where your agents have names and profile images, talk to you and to each other, and run heartbeat-style check-ins that sometimes spark small conversations between them. When you're all collaborating, it can feel genuinely *alive*â€”like you're building together.

---

## Current State

### What Works âœ…
- **ASK_AGENT** â€” One agent asks another, relays answer (plugin-inter-agent)
- **Option C Discord** â€” Separate bot identities per agent
- **A2A Policy** â€” `allowedTargets` + `allow` rules per character
- **Standups** â€” Kelly-coordinated 2Ã—/day meetings
- **Deliverables** â€” PRD, essays, tweets, trades written to `standup-deliverables/`
- **Cross-agent providers** â€” bankrOrdersProvider (VINCE sees Otaku's orders)

### What's Missing âŒ
- **Feedback flow** â€” User feedback â†’ Sentinel triage â†’ PRD or Eliza task
- **Async A2A** â€” "Ask Vince and get back to me" (not blocking)
- **Workflow orchestration** â€” Multi-step flows across agents
- **Solus + Execution** â€” Solus decides â†’ Otaku/BANKR executes
- **Agent collaboration testing** â€” E2E tests for A2A flows
- **Inter-agent memory** â€” Shared context for conversations

---

## Proposed v2.4 Scope

### 1. ğŸ”„ Feedback Flow (Priority: HIGH)

**From MULTI_AGENT.md â€” planned but not implemented:**

```
User: "FEEDBACK: Kelly should recommend Biarritz restaurants"
  â†“
Kelly (tested agent) â†’ ASK_AGENT Sentinel with feedback + context
  â†“
Sentinel triages:
  â€¢ Code/behavior fix â†’ PRD for Cursor
  â€¢ Knowledge gap â†’ Eliza task
  â†“
Sentinel returns confirmation â†’ Kelly relays to user
```

**New components:**
- `FEEDBACK` action in plugin-inter-agent
- `SENTINEL_FEEDBACK_DELIVERABLE` action in plugin-sentinel
- New deliverable type: `eliza-tasks/` for knowledge gaps

**Estimated:** 4 files, ~600 lines

---

### 2. âš¡ Async ASK_AGENT (Priority: HIGH)

**Current:** ASK_AGENT blocks up to 90s waiting for reply.
**Proposed:** Option to fire-and-forget with callback.

```typescript
// Sync (current)
"ask Vince about Bitcoin" â†’ waits â†’ "Vince says: ..."

// Async (new)
"ask Vince about Bitcoin and get back to me"
  â†’ "I'll ask Vince and let you know"
  â†’ (background)
  â†’ "Update: Vince says: ..."
```

**Implementation options:**
1. **Subagent room pattern** â€” Create dedicated room, run in background, post summary when done
2. **Task queue** â€” Use standup action item pattern for async A2A
3. **OpenClaw-style sessions** â€” sessions_send with reply-back (if we want that pattern)

**Estimated:** 2-3 files, ~400 lines

---

### 3. ğŸ”— Solus + Execution Flow (Priority: MEDIUM)

**From v2.3 plan â€” deferred:**

Solus does execution planning (size/skip/watch). BANKR could be the execution layer.

```
User â†’ "I want to long BTC"
  â†“
VINCE â†’ data context (funding, OI, sentiment)
  â†“
Solus â†’ size/skip/watch + invalidation level
  â†“
Otaku â†’ executes via BANKR with stop loss
```

**New components:**
- `SOLUS_EXECUTION_PLAN` action â€” outputs structured plan
- `OTAKU_EXECUTE_PLAN` action â€” consumes plan, executes via BANKR
- Cross-agent message format for execution plans

**Estimated:** 4 files, ~800 lines

---

### 4. ğŸ§ª Multi-Agent E2E Tests (Priority: MEDIUM)

**Current:** No tests for ASK_AGENT working across agents.

**Proposed:**
```
tests/
  e2e/
    askAgent.e2e.test.ts      # Kelly asks Vince, gets reply
    feedbackFlow.e2e.test.ts  # Feedback â†’ Sentinel â†’ PRD
    executionFlow.e2e.test.ts # Solus plan â†’ Otaku execute
```

**Challenges:**
- Need multiple runtimes in test
- Mock vs real LLM responses
- Timing and async handling

**Estimated:** 3 files, ~500 lines

---

### 5. ğŸ§  Inter-Agent Memory (Priority: LOW)

**Current:** Each agent has its own memory. No shared context.

**Proposed:** Shared facts/context for multi-agent conversations.

Options:
1. **Shared room memories** â€” Standup room memories accessible to all
2. **Cross-agent facts** â€” Write facts with `sharedWith: ["Vince", "Kelly"]`
3. **Context provider** â€” Provider that fetches recent cross-agent interactions

**Estimated:** 2 files, ~300 lines

---

### 6. ğŸ“Š Agent Coordination Dashboard (Priority: LOW)

**Proposed route:** `/vince/agents`

Shows:
- Agent status (online/offline)
- Recent A2A interactions
- Standup history
- Relationship health (opinion scores)

**Estimated:** 2 files, ~400 lines

---

## Recommended Priorities

**Must have (v2.4.0):**
1. âœ… Feedback flow (user testing â†’ PRD/Eliza task)
2. âœ… Async ASK_AGENT (non-blocking option)

**Should have (v2.4.x):**
3. Solus + Execution flow
4. Multi-agent E2E tests

**Nice to have (v2.5+):**
5. Inter-agent memory
6. Agent coordination dashboard

---

## Estimated Total Effort

| Item | Files | Lines | Priority |
|------|-------|-------|----------|
| Feedback flow | 4 | ~600 | HIGH |
| Async ASK_AGENT | 3 | ~400 | HIGH |
| Solus + Execution | 4 | ~800 | MEDIUM |
| E2E tests | 3 | ~500 | MEDIUM |
| Inter-agent memory | 2 | ~300 | LOW |
| Dashboard | 2 | ~400 | LOW |
| **Total** | **18** | **~3,000** | â€” |

---

## Questions for Yves

1. **Feedback flow first?** It's documented in MULTI_AGENT.md as the next step.
2. **Async pattern preference?** Subagent room vs task queue vs something else?
3. **Solus + Execution scope?** Full flow or just the interface/plan format?
4. **E2E testing approach?** Mock LLM or use real (slower, costs)?
5. **Any other multi-agent pain points** you've hit in testing?

---

## References

- `MULTI_AGENT.md` â€” Full architecture vision
- `plugin-inter-agent/` â€” ASK_AGENT, standups
- `plugin-sentinel/` â€” SENTINEL_MULTI_AGENT action
- `docs/STANDUP_DELIVERABLES.md` â€” Deliverable types
- `docs/NORTH_STAR_DELIVERABLES.md` â€” Essay, tweets, PRD, etc.
