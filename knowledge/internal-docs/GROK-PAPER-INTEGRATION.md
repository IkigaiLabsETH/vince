# Grok Auto-Pulse ↔ Paper Trading Algo

The daily **Grok Expert Auto-Pulse** files (`knowledge/internal-docs/grok-auto-*.md`) are generated by the `GROK_EXPERT_DAILY_PULSE` task. They contain a structured market read and **Top 3 Research Ideas**. Here’s where and how they feed into the paper trading algo.

---

## Where they’re used

### 1. **Signal aggregator (GrokExpert source)**

- **What:** The paper algo’s signal aggregator reads the **latest** `grok-auto-*.md` (by file mtime) and parses the **Top 3 Research Ideas** section.
- **How:** For each idea that mentions an asset (BTC, ETH, SOL, HYPE), it infers a direction (long/short) from phrases like “Long ETH-USD perp”, “Buy BTC $100K calls”, “Stack SOL HIP-3”. It then emits a `MarketSignal` with source `GrokExpert` for that asset.
- **Effect:** GrokExpert is one of many signal sources. Its weight in the dynamic config is **0.5** (narrative nudge, not a primary driver).
- **Code:** `grokPulseParser.ts`, `signalAggregator.service.ts` block “5c. Grok Expert Auto-Pulse”, `dynamicConfig.ts` source weight `GrokExpert: 0.5`.
- **Staleness:** Pulse files older than **36 hours** are ignored.

### 2. **Regime filter**

- **What:** When Grok’s daily regime disagrees with the aggregated signal direction, confidence is capped so the trade is less likely to clear thresholds.
- **How:** If `GROK_REGIME_FILTER_ENABLED` is true and the latest pulse has `Regime: bearish` while the aggregate is long (or `Regime: bullish` while aggregate is short), confidence is capped at 50 and a factor is added: “Grok regime disagrees (bearish) - confidence capped”.
- **Env:** `GROK_REGIME_FILTER_ENABLED=true` to enable (default off).
- **Code:** `signalAggregator.service.ts` after ML enhancement, before cache set.

### 3. **Feature store (Fear & Greed / Top Traders)**

- **What:** At decision time (trade or avoided), the feature record can include Grok’s Fear & Greed and Top Traders % from the latest pulse.
- **How:** Optional field `grokPulse?: { fearGreed?: number; topTradersLongPct?: number }` on `FeatureRecord`. Populated in `recordDecision` and `recordAvoidedDecision` when a pulse is available.
- **Sanity check:** If Grok F&G and CoinGlass F&G both exist and differ by more than 15 points, a debug log is written: “Grok F&G (X) vs CoinGlass (Y) - large divergence”. No change to signals.
- **Code:** `vinceFeatureStore.service.ts`. Persistence: JSONL stores the full object; if Supabase table uses a single JSONB payload it works as-is; otherwise add optional column `grok_pulse` (JSONB) or two nullable numeric columns.

### 4. **Market Read in bot explanations**

- **What:** The “Market Read” paragraph from the latest pulse is injected into the context when generating “why trade” and “bot verdict” briefings.
- **How:** Helper `getGrokMarketReadSection()` returns a formatted block or empty string. VINCE_WHY_TRADE and VINCE_BOT_VERDICT append it to the data context before calling the LLM, so the briefing can reference the daily narrative.
- **Code:** `grokPulseParser.ts` (`getGrokMarketReadSection`), `vinceWhyTrade.action.ts`, `botVerdict.action.ts`.

### 5. **Knowledge Gap (backtests / knowledge updates)**

- **What:** The daily “Knowledge Gap” line is logged and optionally turned into a reminder task.
- **How:** After the Grok task saves the pulse, it parses **Knowledge Gap**. If present: (1) appends a line to `knowledge/internal-docs/knowledge-gaps-log.md` in the form `- **YYYY-MM-DD**: <text>` (with a “## Knowledge gaps” header on first create); (2) creates a one-off task `KNOWLEDGE_GAP_FOLLOW_UP` with description and metadata so it appears in the task list as a reminder. No worker is required for the task.
- **Code:** `grokExpert.tasks.ts` (after `saveTaskResult`), `parseKnowledgeGap` from `grokPulseParser.ts`.

---

## File format (for parsing)

The parser expects:

- **Regime:** Line containing `Regime: neutral` (or `bullish` / `bearish`).
- **Fear & Greed:** `Fear & Greed: 9/100`.
- **Top Traders:** `Top Traders: 55.1% long`.
- **Top 3 Research Ideas:** Section starting with `**Top 3 Research Ideas**`, followed by numbered lines. Asset and direction are inferred from keywords and tickers (BTC, ETH, SOL, HYPE).
- **Market Read:** Paragraph after `**Market Read**` until the next `**`-headed line.
- **Knowledge Gap:** Line/paragraph after `**Knowledge Gap**` until the next `**`-headed line.

Other sections (e.g. Prompt of the Day) remain for humans only.
